# Phase T2: Task Generation Procedures

Detailed procedures for the Generation phase (task-builder, phase 2).

---

## Mission

Generate the complete `tasks.md` file from validated `task-mapping.md`. Create properly formatted, ordered, and marked implementation tasks with dependency graphs and brownfield markers.

---

## Phase Structure

Organize tasks into phases in this order:

### 1. Phase 1: Setup
- Project initialization (if needed)
- Configuration files
- Shared infrastructure

### 2. Phase 2: Foundational
- Blocking prerequisites for all stories
- Shared models/utilities
- Database setup (if applicable)

### 3. Phases 3+: User Stories
- One phase per user story in priority order (P1, P2, P3...)
- Each phase is independently testable
- Include: Models -> Services -> Endpoints -> Integration

### 4. Final Phase: Polish
- Cross-cutting concerns
- Documentation updates
- Cleanup tasks

---

## Task Format

**Strict format**: Every task MUST follow this pattern:
```
- [ ] T### [Marker?] [P?] [Story?] Description with file path
```

### Format Components

| Component | Required | Format | Example |
|-----------|----------|--------|---------|
| Checkbox | Yes | `- [ ]` | `- [ ]` |
| Task ID | Yes | `T###` | `T001`, `T012` |
| Brownfield Marker | If applicable | `[EXTEND]`, `[MODIFY]`, `[CONFLICT]` | `[EXTEND]` |
| Parallel Flag | If applicable | `[P]` | `[P]` |
| Story Label | In story phases only | `[US#]` | `[US1]` |
| Description | Yes | Action + file path | `Add field in src/models/task.py` |

### Component Order

```
- [ ] T### [BROWNFIELD] [P] [US#] Description path
```

### Examples

```markdown
- [ ] T001 Create project configuration in config/settings.py
- [ ] T005 [P] Create Priority enum in src/models/priority.py
- [ ] T006 [EXTEND] [P] [US1] Add priority field to Task model in src/models/task.py
- [ ] T012 [MODIFY] [US2] Update TaskService with filter in src/services/task_service.py
- [ ] T015 [CONFLICT] [US3] Resolve validation conflict in src/routes/tasks.py
```

---

## Brownfield Markers

Apply markers from task-mapping.md brownfield analysis:

| Task Type | Existing File | Marker |
|-----------|---------------|--------|
| Create model | No | (none) |
| Add field to model | Yes | `[EXTEND]` |
| Add method to service | Yes | `[EXTEND]` |
| Change validation logic | Yes | `[MODIFY]` |
| Restructure existing | Yes | `[MODIFY]` |
| High-risk collision | Yes | `[CONFLICT]` |

*See [BROWNFIELD.md](BROWNFIELD.md) for detailed guidelines.*

---

## Parallel Flag [P]

Mark tasks with `[P]` when they can run concurrently:

### Parallelizable IF:
- Different files (no overlap)
- No dependency on incomplete tasks
- Within same phase

### NOT Parallelizable IF:
- Same file
- Depends on task not yet complete
- Sequential by nature (migration, then seed)

### Grouping

Tasks marked `[P]` in the same section can run together:
```markdown
- [ ] T005 [P] Create Priority enum in src/models/priority.py
- [ ] T006 [P] Create TaskStatus enum in src/models/status.py
- [ ] T007 [P] Create validation utils in src/utils/validators.py
```

---

## Story Labels

Apply `[US#]` labels ONLY in user story phases:

| Phase | Label Applied |
|-------|---------------|
| Setup | No |
| Foundational | No |
| US1 Phase | `[US1]` |
| US2 Phase | `[US2]` |
| Polish | No |

---

## Dependency Graph

Create dependency section showing:

### Task-Level Dependencies
```
T001 --> T002, T003
T004 --> T006
T006 --> T007, T008, T009, T010
```

### Story-Level Dependencies
```markdown
| Story | Depends On | Reason |
|-------|------------|--------|
| US2 | US1 | Filter requires priority field to exist |
| US3 | - | Independent |
```

### Parallel Execution Groups
```markdown
| Phase | Group | Tasks | Can Run With |
|-------|-------|-------|--------------|
| Setup | 1 | T002, T003 | Each other |
| US1 | 1 | T007, T008 | Each other |
```

---

## tasks.md Format

```markdown
# Implementation Tasks: {feature_id}

> Generated by task-builder agent (phase 2)
> Iteration: {iteration}
> Timestamp: {timestamp}

---

## Overview

| Metric | Value |
|--------|-------|
| Total Tasks | {total} |
| Phases | {phase_count} |
| Parallelizable | {parallel_count} |
| Brownfield Tasks | {brownfield_count} |

---

## Phase 1: Setup

> Project initialization and configuration.

- [ ] T001 Create project configuration in config/settings.py
- [ ] T002 [P] Set up database connection in src/db/connection.py
- [ ] T003 [P] Create base model class in src/models/base.py

---

## Phase 2: Foundational

> Blocking prerequisites for all user stories.

- [ ] T004 Create Priority enum in src/models/priority.py
- [ ] T005 Create shared validation utilities in src/utils/validators.py

---

## Phase 3: US1 - [P1] User can set task priority

> MVP functionality for task priority.

### Implementation Tasks

- [ ] T006 [EXTEND] [US1] Add priority field to Task model in src/models/task.py
- [ ] T007 [P] [US1] Create TaskPriorityService in src/services/priority_service.py
- [ ] T008 [P] [US1] Add priority validation in src/validators/task_validator.py
- [ ] T009 [MODIFY] [US1] Update POST /tasks endpoint in src/routes/tasks.py
- [ ] T010 [MODIFY] [US1] Update PUT /tasks/{id} endpoint in src/routes/tasks.py

### Completion Criteria

- Task model has priority field with enum constraint
- Create and update endpoints accept priority parameter
- Validation rejects invalid priority values

---

## Phase N: Polish

> Cross-cutting concerns and cleanup.

- [ ] T0XX Update API documentation in docs/api.md
- [ ] T0XX Add priority to task list UI in src/components/TaskList.tsx

---

## Dependencies

### Task Dependencies

```
T001 --> T002, T003
T004 --> T006
T006 --> T007, T008, T009, T010
T009 --> T011
```

### Story Dependencies

| Story | Depends On | Reason |
|-------|------------|--------|
| US2 | US1 | Filter requires priority field |

### Parallel Execution Groups

| Phase | Group | Tasks |
|-------|-------|-------|
| Setup | 1 | T002, T003 |
| US1 | 1 | T007, T008 |

---

## Implementation Strategy

### MVP Scope (Recommended First)

Complete Phase 1-3 for minimal viable feature:
- Setup + Foundational + US1
- Provides core functionality
- Can demo and get feedback

### Incremental Delivery

1. **Increment 1**: Phases 1-3 (Setup + Foundation + US1)
2. **Increment 2**: Phase 4 (US2)
3. **Increment 3**: Phase 5+ (remaining stories)
4. **Final**: Polish phase

---

## Brownfield Summary

| Marker | Count | Files |
|--------|-------|-------|
| [EXTEND] | {count} | {file_list} |
| [MODIFY] | {count} | {file_list} |
| [CONFLICT] | {count} | {file_list} |
```

---

## Quality Checklist

Before returning, verify:
- [ ] Every task has checkbox `- [ ]`
- [ ] Every task has sequential ID (T001, T002...)
- [ ] Every task has file path in description
- [ ] Brownfield markers match mapping analysis
- [ ] `[P]` markers only on truly parallelizable tasks
- [ ] `[US#]` labels only in story phases
- [ ] Dependencies are valid (no circular refs)
- [ ] All mapped entities/endpoints have tasks
- [ ] tasks.md follows template structure
- [ ] tasks-context.md Phase T2 section is updated
- [ ] index.md Tasks Phase State is updated
